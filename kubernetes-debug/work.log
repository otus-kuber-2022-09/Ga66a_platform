#install kubectl-debug
apt update && \
apt install git -y && \
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" && \
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)" && \
brew install gcc && \
brew install aylei/tap/kubectl-debug

cd /root && \
curl -LJO https://github.com/aylei/kubectl-debug/releases/download/v0.1.1/kubectl-debug_0.1.1_linux_amd64.tar.gz && \
tar -xzf kubectl-debug_0.1.1_linux_amd64.tar.gz && \
cp kubectl-debug /usr/bin

#Debug agent
kubectl apply -f https://raw.githubusercontent.com/otus-kuber-2022-09/Ga66a_platform/kubernetes-debug/kubernetes-debug/agent_daemonset.yml

#Nginx test pod
kubectl apply -f https://raw.githubusercontent.com/otus-kuber-2022-09/Ga66a_platform/kubernetes-debug/kubernetes-debug/nginx_pod.yaml

kubectl debug nginx --image=busybox -it --share-processes --copy-to=nginx-debug

strace -t -e trace=open,close,read,getdents,write,connect,accept -p 7
strace -p 7  -s 10000 -v -f
strace -e trace=network nc -v -n 127.0.0.1 80